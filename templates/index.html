<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web-NER Demo</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    textarea { width: 100%; height: 150px; }
    .checkboxes { margin: 1em 0; }
    .checkboxes label {
      margin-right: 1em;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      background: #eee;
      cursor: pointer;
    }
    .checkboxes label.active {
      color: #000;
    }
    .btn-group button {
      margin-right: 0.5em;
      padding: 0.3em 0.6em;
      border: none;
      border-radius: 4px;
      background: #4285f4;
      color: white;
      cursor: pointer;
    }
    .btn-group button.clear {
      background: #db4437;
    }
  </style>
</head>
<body>
  <h1>Named Entity Recognition</h1>

  <form id="ner-form"
        action="{{ url_for('ner') }}"
        method="post"
        enctype="multipart/form-data">

    <!-- 1) Manual text input -->
    <label for="text">Enter text (150–200 words):</label><br>
    <textarea id="text" name="text">{{ request.form.text or '' }}</textarea><br><br>

    <!-- 2) File upload -->
    <label for="file">Or upload a document:</label><br>
    <input type="file" id="file" name="file" accept=".pdf,.doc,.docx"><br><br>

    <!-- 3) Select / Clear All buttons -->
    <div class="btn-group">
      <button type="button" id="select-all">Select All</button>
      <button type="button" id="clear-all" class="clear">Clear All</button>
    </div>

    <!-- 4) The checkboxes -->
    <div class="checkboxes">
      <strong>Select entity types:</strong><br>
      {% for label in labels %}
        <label id="lab-{{ label }}">
          <input
            type="checkbox"
            name="entities"
            value="{{ label }}"
            {% if label in request.form.getlist('entities') %}checked{% endif %}>
          {{ label }}
        </label>
      {% endfor %}
    </div>

    <button type="submit">Process</button>
  </form>

  <script>
    // Grab our arrays of labels and colors from Flask context
    const colors = {{ colors|tojson }};
    const checkboxes = document.querySelectorAll('.checkboxes input[type=checkbox]');
    const textarea  = document.getElementById('text');
    const fileInput = document.getElementById('file');

    // Helper to color a label when its box is checked
    function updateLabel(cb) {
      const lab = document.getElementById('lab-' + cb.value);
      if (cb.checked) {
        lab.classList.add('active');
        lab.style.backgroundColor = colors[cb.value];
      } else {
        lab.classList.remove('active');
        lab.style.backgroundColor = '#eee';
      }
    }

    // Initialize and wire each checkbox
    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => updateLabel(cb));
      updateLabel(cb);
    });

    // “Select All” / “Clear All”
    document.getElementById('select-all').addEventListener('click', () => {
      checkboxes.forEach(cb => { cb.checked = true;  updateLabel(cb); });
    });
    document.getElementById('clear-all').addEventListener('click', () => {
      checkboxes.forEach(cb => { cb.checked = false; updateLabel(cb); });
    });

    // File → textarea extraction
    fileInput.addEventListener('change', async () => {
      if (!fileInput.files.length) return;
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      const resp = await fetch('{{ url_for("extract_text") }}', {
        method: 'POST',
        body: formData
      });
      if (!resp.ok) {
        console.error('Extraction error');
        return;
      }
      const data = await resp.json();
      textarea.value = data.text;
    });
  </script>
</body>
</html>
